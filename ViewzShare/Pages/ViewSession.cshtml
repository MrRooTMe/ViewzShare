@page
@model ViewSessionModel
@using System.Collections.Generic
@using System.Linq

@functions {
    private static string ResolveGalleryCategory(ApartmentItem item)
    {
        if (item is null)
        {
            return "interior";
        }

        var source = ($"{item.Title} {item.ApartmentId}").ToLowerInvariant();

        if (source.Contains("חוץ") || source.Contains("חזית") || source.Contains("facade") || source.Contains("exterior") || source.Contains("outside") || source.Contains("outdoor"))
        {
            return "exterior";
        }

        if (source.Contains("לובי") || source.Contains("קומון") || source.Contains("common") || source.Contains("public") || source.Contains("ציבור") || source.Contains("משות"))
        {
            return "common";
        }

        return "interior";
    }

    private static string GetCategoryLabel(string category) => category switch
    {
        "exterior" => "חוץ",
        "common" => "שטחים משותפים",
        _ => "פנים"
    };
}
@{
    Layout = null; // full-screen page without site layout
    ViewData["Title"] = Model.Title;
}

<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
    <title>@Model.Title</title>

    <style>
        :root {
            --bg: #0e0f13;
            --panel: #16181e;
            --panel-2: #1f2128;
            --text: #e8e8e8;
            --muted: #9da3b1;
            --accent: #FFFFFF;
            --border: #2b2e36;
            --radius: 16px;
            --shadow: 0 8px 24px rgba(0,0,0,0.45);
        }

        html, body {
            height: 100%;
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: "Inter","Rubik","Noto Sans Hebrew",system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
            /* window-level scroll snap */
            scroll-snap-type: y mandatory;
            overflow-x: hidden;
        }

        /* Sections */
        .section {
            min-height: 100svh;
            width: 100vw;
            scroll-snap-align: start;
            position: relative; /* for background media */
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            padding: 80px 24px;
        }

        /* Background media (video / iframe) */
        .bg-media {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; /* for <video> */
            background: #000;
            z-index: 0;
        }
        /* Background iframe needs different sizing rules than video */
        .bg-frame-wrap {
            position: absolute;
            inset: 0;
            z-index: 0;
        }

            .bg-frame-wrap iframe {
                width: 100%;
                height: 100%;
                border: 0;
                display: block;
                background: #000;
                /* Avoid capturing scroll by default. Set to auto if you want interaction. */
                pointer-events: auto;
            }

        /* Dark overlay for readability on top of background media */
        .overlay {
            position: absolute;
            inset: 0;
            z-index: 1;
            background: linear-gradient(180deg, rgba(0,0,0,.45), rgba(0,0,0,.35));
        }

        /* Foreground content (titles/cards/buttons) */
        .content {
            position: relative;
            z-index: 2;
            width: min(1100px, 94vw);
            text-align: center;
        }

            .content h2 {
                margin: 0 0 12px;
                font-size: clamp(20px,3vw,32px);
                font-weight: 800;
                background: linear-gradient(90deg,var(--accent),#FFFFFF);
                -webkit-background-clip: text;
                background-clip: text;
                color: transparent;
            }

            .content p {
                margin: 0 0 24px;
                font-size: 14px;
                color: var(--muted);
            }

        html.no-snap,
        body.no-snap {
            scroll-snap-type: none !important;
        }

        .section.gallery-section,
        .section.liked-section {
            align-items: flex-start;
        }

        .gallery-wrapper,
        .liked-container {
            width: min(1100px,94vw);
            background: linear-gradient(145deg, rgba(22,24,30,0.92), rgba(31,33,40,0.88));
            border: 1px solid rgba(255,255,255,0.06);
            border-radius: calc(var(--radius) + 4px);
            box-shadow: var(--shadow);
            padding: clamp(20px, 3vw, 36px);
            backdrop-filter: blur(12px);
        }

        .gallery-wrapper {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .gallery-header,
        .liked-header {
            text-align: center;
        }

        .section-eyebrow {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 999px;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: .04em;
            text-transform: uppercase;
            background: rgba(16,163,127,0.12);
            color: rgba(255,255,255,0.85);
        }

        .gallery-header h2,
        .liked-header h2 {
            margin-top: 16px;
            margin-bottom: 8px;
            font-size: clamp(24px, 4vw, 38px);
            letter-spacing: -0.01em;
        }

        .gallery-header p,
        .liked-header p {
            margin: 0;
            font-size: 15px;
            color: var(--muted);
        }

        .gallery-tabs {
            display: inline-flex;
            gap: 12px;
            align-self: center;
            padding: 6px;
            border-radius: 999px;
            background: rgba(15,17,22,0.85);
            border: 1px solid rgba(255,255,255,0.05);
        }

        .gallery-tab {
            border: 0;
            border-radius: 999px;
            padding: 10px 18px;
            font-size: 14px;
            font-weight: 600;
            background: transparent;
            color: var(--muted);
            cursor: pointer;
            transition: background .18s ease, color .18s ease, transform .1s ease;
        }

            .gallery-tab:hover {
                color: #fff;
                background: rgba(16,163,127,0.12);
            }

            .gallery-tab:focus-visible {
                outline: 2px solid rgba(16,163,127,0.65);
                outline-offset: 2px;
            }

            .gallery-tab.active {
                background: linear-gradient(135deg, rgba(16,163,127,0.35), rgba(16,163,127,0.22));
                color: #fff;
                box-shadow: 0 8px 22px rgba(16,163,127,0.18);
            }

        .gallery-grid {
            display: grid;
            gap: 18px;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        }

        .gallery-item {
            position: relative;
            border-radius: calc(var(--radius) - 4px);
            background: rgba(12,13,18,0.85);
            border: 1px solid rgba(255,255,255,0.05);
            overflow: hidden;
            box-shadow: 0 14px 32px rgba(0,0,0,0.35);
            transition: transform .2s ease, box-shadow .2s ease;
        }

            .gallery-item.hidden {
                display: none;
            }

            .gallery-item:hover {
                transform: translateY(-4px);
                box-shadow: 0 18px 36px rgba(0,0,0,0.45);
            }

            .gallery-item img,
            .gallery-fallback {
                width: 100%;
                aspect-ratio: 4 / 3;
                object-fit: cover;
                display: block;
                background: #111;
            }

        .gallery-fallback {
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255,255,255,0.6);
            font-size: 15px;
            padding: 16px;
        }

        .gallery-item figcaption {
            padding: 12px 16px 16px;
        }

        .gallery-item-title {
            font-weight: 700;
            font-size: 15px;
            margin-bottom: 6px;
            color: #fff;
        }

        .gallery-item-meta {
            font-size: 13px;
            color: rgba(255,255,255,0.6);
        }

        .gallery-empty {
            margin-top: 8px;
            display: none;
            align-items: center;
            justify-content: center;
            min-height: 120px;
            color: var(--muted);
            font-size: 15px;
            background: rgba(12,13,18,0.75);
            border-radius: calc(var(--radius) - 6px);
            border: 1px dashed rgba(255,255,255,0.1);
        }

            .gallery-empty.show {
                display: flex;
            }

        .liked-container {
            display: flex;
            flex-direction: column;
            gap: 32px;
        }

        .liked-scroll {
            max-height: clamp(280px, calc(100svh - 220px), 620px);
            overflow-y: auto;
            overscroll-behavior: contain;
            padding-inline-end: 6px;
            scrollbar-gutter: stable;
        }

        .liked-header {
            max-width: 540px;
            margin: 0 auto;
        }

        .liked-grid {
            display: grid;
            gap: 20px;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .apt-card {
            background: rgba(15,17,22,0.9);
            border: 1px solid rgba(255,255,255,0.04);
            border-radius: calc(var(--radius) - 2px);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: transform .2s ease, box-shadow .2s ease;
        }

            .apt-card:hover {
                transform: translateY(-3px);
                box-shadow: 0 18px 36px rgba(0,0,0,0.45);
            }

        .apt-thumb {
            width: 100%;
            aspect-ratio: 4 / 3;
            object-fit: cover;
            background: #121318;
        }

        .apt-body {
            padding: 18px 20px 22px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .apt-name {
            font-size: 17px;
            font-weight: 700;
            margin: 0;
            color: #fff;
        }

        .apt-meta {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: rgba(255,255,255,0.65);
        }

            .apt-meta .sep {
                opacity: .4;
            }

        .apt-action {
            margin-top: auto;
        }

        .liked-empty {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 180px;
            border-radius: calc(var(--radius) - 4px);
            border: 1px dashed rgba(255,255,255,0.1);
            color: var(--muted);
            font-size: 15px;
            background: rgba(12,13,18,0.75);
        }

        .btn {
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 999px;
            border: 1px solid rgba(16,163,127,0.25);
            background: linear-gradient(135deg, rgba(16,163,127,0.22), rgba(16,163,127,0.12));
            color: #e9f7f2;
            font-size: 14px;
            font-weight: 700;
            transition: transform .1s ease, box-shadow .18s ease, border-color .18s ease;
        }

            .btn:hover {
                border-color: rgba(16,163,127,0.45);
                box-shadow: 0 10px 24px rgba(16,163,127,0.2);
                color: #fff;
            }

            .btn:active {
                transform: translateY(1px);
            }

            .btn svg {
                width: 16px;
                height: 16px;
                stroke: currentColor;
            }

        /* Sticky logo */
        .logo {
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 9999;
            background: rgba(0,0,0,.35);
            backdrop-filter: blur(8px);
            padding: 6px 10px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,.1);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

            /* Responsive logo image: small on phones, larger on desktop */
            .logo img {
                display: block;
                width: clamp(90px, 20vw, 180px);
                height: auto;
                object-fit: contain;
            }

            .logo span {
                font-size: 14px;
                font-weight: 700;
                color: var(--text);
            }

        /* Right-side circular arrows */
        .nav-arrows {
            position: fixed;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 9998;
        }

        .arrow {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid var(--border);
            background: rgba(0,0,0,.35);
            backdrop-filter: blur(6px);
            color: #eaecef;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background .15s ease, border-color .15s ease, transform .08s ease;
        }

            .arrow:hover {
                background: rgba(0,0,0,.45);
                border-color: var(--accent);
            }

            .arrow:active {
                transform: translateY(1px);
            }

            .arrow svg {
                width: 18px;
                height: 18px;
                stroke: currentColor;
            }

        /* Top-center banner over the movie */
        .hero-banner {
            position: absolute;
            top: 24px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2; /* above the overlay & video */
            color: #fff;
            background: rgba(0,0,0,0.10); /* ~10% black */
            padding: 10px 16px;
            border-radius: 999px;
            font-weight: 700;
            font-size: clamp(14px, 2.5vw, 18px);
            line-height: 1.2;
            box-shadow: 0 2px 10px rgba(0,0,0,0.25);
            text-align: center;
            white-space: nowrap;
            max-width: 90vw;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* Smooth hide when entering interact mode */
        #sec2 .overlay,
        #sec2 .content {
            transition: opacity .25s ease;
        }

        /* Default: background mode (overlay+text visible, iframe not clickable) */
        .bg-frame-wrap iframe {
            pointer-events: none;
        }

        /* Interact mode: hide overlay + text; enable iframe pointer events */
        #sec2.interact .overlay,
        #sec2.interact .content {
            opacity: 0;
            pointer-events: none;
        }

        #sec2.interact .bg-frame-wrap iframe {
            pointer-events: auto;
        }

    </style>
</head>
<body>

    @{
        var likedItems = Model.Session?.Items ?? new List<ApartmentItem>();
        var galleryItems = likedItems
            .Where(item => !string.IsNullOrWhiteSpace(item.PlanImageUrl))
            .Select(item => new { Item = item, Category = ResolveGalleryCategory(item) })
            .ToList();
        var galleryCategories = new List<(string Id, string Label)>
        {
            ("interior", "פנים"),
            ("exterior", "חוץ"),
            ("common", "שטחים משותפים")
        };
        var defaultGalleryCategory = galleryCategories[0].Id;
        var hasGalleryItems = galleryItems.Any();
    }

    <div class="logo">
        <img src="@Model.LogoUrl" alt="Project Logo" />
    </div>


    <div class="nav-arrows" aria-label="ניווט בין מקטעים">
        <button class="arrow" type="button" onclick="scrollPrev()" title="למעלה" aria-label="למעלה">
            <svg viewBox="0 0 24 24" fill="none"><path d="M6 15l6-6 6 6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" /></svg>
        </button>
        <button class="arrow" type="button" onclick="scrollNext()" title="למטה" aria-label="למטה">
            <svg viewBox="0 0 24 24" fill="none"><path d="M18 9l-6 6-6-6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" /></svg>
        </button>
    </div>

    <!-- SECTION 1: MOVIE AS BACKGROUND -->
    <section id="sec1" class="section">
        <video class="bg-media" src="@Model.MovieUrl" autoplay muted loop playsinline preload="auto"></video>
        <div class="overlay"></div>
        <div class="content">
            <h2>@Model.Session.ProjectId</h2>
        </div>
    </section>

    <!-- SECTION 2: SPLATTER AS BACKGROUND -->
    <section id="sec2" class="section">
        @if (!string.IsNullOrWhiteSpace(Model.SplatterUrl))
        {
            <div class="bg-frame-wrap">
                <iframe src="@Model.SplatterUrl" allow="fullscreen; xr-spatial-tracking; gyroscope; accelerometer"></iframe>
            </div>
            <div class="overlay"></div>
            <div class="content">
                <h2>סיור תלת מימד</h2>
                <p> לחץ כדי להפעיל אינטראקציה</p>
            </div>
        }
        else
        {
            <div class="content">
                <h2>סיור תלת־ממדי (Gaussian Splatting)</h2>
                <p style="color:var(--muted);">לא סופק קישור splatter — הוסיפו ‎?splat=URL לשורת הכתובת.</p>
            </div>
        }
    </section>

    <!-- SECTION 3: PROJECT GALLERY -->
    <section id="sec3" class="section gallery-section">
        <div class="gallery-wrapper" data-gallery>
            <div class="gallery-header">
                <span class="section-eyebrow">גלריה</span>
                <h2>גלריית הפרויקט</h2>
                <p>עברו בין קטגוריות שונות כדי לראות זוויות נוספות של הפרויקט.</p>
            </div>

            <div class="gallery-tabs" role="tablist">
                @foreach (var category in galleryCategories)
                {
                    var isActive = category.Id == defaultGalleryCategory;
                    <button type="button"
                            class="gallery-tab@(isActive ? " active" : string.Empty)"
                            role="tab"
                            aria-selected="@(isActive ? "true" : "false")"
                            data-gallery-tab
                            data-category="@category.Id">
                        @category.Label
                    </button>
                }
            </div>

            <div class="gallery-grid" data-gallery-grid>
                @foreach (var entry in galleryItems)
                {
                    var item = entry.Item;
                    var displayTitle = !string.IsNullOrWhiteSpace(item.Title) ? item.Title : item.ApartmentId;
                    var metaParts = new List<string> { GetCategoryLabel(entry.Category) };
                    if (item.Rooms.HasValue)
                    {
                        metaParts.Add($"חדרים {item.Rooms.Value}");
                    }
                    if (item.SizeSqm.HasValue)
                    {
                        metaParts.Add($"מ\"ר {item.SizeSqm.Value:0.#}");
                    }
                    var metaText = string.Join(" • ", metaParts);
                    <figure class="gallery-item" data-gallery-item data-category="@entry.Category">
                        @if (!string.IsNullOrWhiteSpace(item.PlanImageUrl))
                        {
                            <img src="@item.PlanImageUrl" alt="@displayTitle" loading="lazy" decoding="async" />
                        }
                        else
                        {
                            <div class="gallery-fallback"><span>@displayTitle</span></div>
                        }
                        <figcaption>
                            <div class="gallery-item-title">@displayTitle</div>
                            <div class="gallery-item-meta">@metaText</div>
                        </figcaption>
                    </figure>
                }
            </div>

            <div class="gallery-empty@(hasGalleryItems ? string.Empty : " show")" data-gallery-empty>
                @if (hasGalleryItems)
                {
                    <span>לא נמצאו תמונות בקטגוריה שבחרתם.</span>
                }
                else
                {
                    <span>עדיין לא נוספו תמונות גלריה לשיתוף הזה.</span>
                }
            </div>
        </div>
    </section>

    <!-- SECTION 4: LIKED APARTMENTS -->
    <section id="sec4" class="section liked-section">
        <div class="liked-container">
            <div class="liked-header">
                <span class="section-eyebrow">תיק הלקוח</span>
                <h2 class="liked-title">דירות שאהבתי</h2>
                <p class="liked-subtitle">כל התכניות שסומנו במהלך הפגישה מרוכזות כאן בתצוגה אחת נוחה.</p>
            </div>

            <div class="liked-scroll">
                @if (likedItems is { Count: > 0 })
                {
                    <div class="liked-grid">
                        @foreach (var item in likedItems)
                        {
                            var displayTitle = !string.IsNullOrWhiteSpace(item.Title) ? item.Title : item.ApartmentId;
                            <article class="apt-card">
                                @if (!string.IsNullOrWhiteSpace(item.PlanImageUrl))
                                {
                                    <img class="apt-thumb" src="@item.PlanImageUrl" alt="@displayTitle" loading="lazy" decoding="async" />
                                }
                                <div class="apt-body">
                                    <h3 class="apt-name">@displayTitle</h3>
                                    <div class="apt-meta">
                                        @if (item.Rooms.HasValue)
                                        {
                                            <span>חדרים @item.Rooms.Value</span>
                                        }
                                        @if (item.Rooms.HasValue && item.SizeSqm.HasValue)
                                        {
                                            <span class="sep">•</span>
                                        }
                                        @if (item.SizeSqm.HasValue)
                                        {
                                            <span>מ"ר @item.SizeSqm.Value.ToString("0.#")</span>
                                        }
                                    </div>
                                    @if (!string.IsNullOrWhiteSpace(item.PdfUrl))
                                    {
                                        <div class="apt-action">
                                            <a class="btn" href="@item.PdfUrl" target="_blank" rel="noopener">
                                                <svg viewBox="0 0 24 24" fill="none">
                                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
                                                    <path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
                                                    <path d="M12 15V3" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
                                                </svg>
                                                הורדת תוכנית
                                            </a>
                                        </div>
                                    }
                                </div>
                            </article>
                        }
                    </div>
                }
                else
                {
                    <div class="liked-empty">
                        אין דירות שמורות כרגע — ודאו שקיים token חוקי ב־URL או התחילו לשמור דירות במהלך הסשן.
                    </div>
                }
            </div>
        </div>
    </section>

    <script>
        const ids = ["sec1","sec2","sec3","sec4"];
        const sec2El = document.getElementById("sec2");
        const scroller = document.scrollingElement || document.documentElement;

        // enable splatter interaction on click
        if (sec2El) {
          sec2El.addEventListener("click", e => {
            if (e.target.closest(".nav-arrows")) return;
            sec2El.classList.add("interact");
          }, { passive: true });
        }

        function resetSplatter() {
          sec2El?.classList.remove("interact");
        }

        function currentIndex() {
          const y = window.scrollY + window.innerHeight / 2;
          let best = 0, bestDist = Infinity;
          for (let i = 0; i < ids.length; i++) {
            const el = document.getElementById(ids[i]);
            if (!el) continue;
            const rect = el.getBoundingClientRect();
            const mid = rect.top + window.scrollY + rect.height / 2;
            const d = Math.abs(mid - y);
            if (d < bestDist) { bestDist = d; best = i; }
          }
          return best;
        }

        // Helper: temporarily disable snap so programmatic scroll isn't blocked
        function withSnapDisabled(fn) {
          document.documentElement.classList.add("no-snap");
          document.body.classList.add("no-snap");
          try { fn(); } finally {
            // give the browser time to start the smooth scroll, then re-enable
            setTimeout(() => {
              document.documentElement.classList.remove("no-snap");
              document.body.classList.remove("no-snap");
            }, 350);
          }
        }

        function scrollToIndex(i) {
          const el = document.getElementById(ids[i]);
          if (!el) return;
          withSnapDisabled(() => {
            // Prefer scrollIntoView for reliability across engines
            el.scrollIntoView({ behavior: "smooth", block: "start" });

            // Fallback kick (some engines need a direct scrollTo on the scroller)
            setTimeout(() => {
              const top = el.offsetTop || 0;
              scroller.scrollTo({ top, behavior: "smooth" });
            }, 0);
          });
        }

        // Upper arrow: go one section up (and reset splatter if we're currently on sec2)
        function scrollPrev() {
          const i = currentIndex();
          if (ids[i] === "sec2") resetSplatter();
          scrollToIndex(Math.max(0, i - 1));
        }

        // Lower arrow: jump straight to LAST section (Liked Apartments)
        function scrollNext() {
          resetSplatter(); // keep transition clean
          scrollToIndex(ids.length - 1); // go to sec4
        }

        // Optional: if user scrolls away from Splatter manually, restore overlay
        let scrollTimer;
        window.addEventListener("scroll", () => {
          clearTimeout(scrollTimer);
          scrollTimer = setTimeout(() => {
            const i = currentIndex();
            if (ids[i] !== "sec2") resetSplatter();
          }, 120);
        }, { passive: true });

        // Expose functions for inline onclick handlers
        window.scrollPrev = scrollPrev;
        window.scrollNext = scrollNext;

        // Simple gallery tab controller
        const galleryRoot = document.querySelector('[data-gallery]');
        if (galleryRoot) {
          const tabs = Array.from(galleryRoot.querySelectorAll('[data-gallery-tab]'));
          const galleryItems = Array.from(galleryRoot.querySelectorAll('[data-gallery-item]'));
          const galleryEmpty = galleryRoot.querySelector('[data-gallery-empty]');

          function applyGalleryFilter(category) {
            let visible = 0;
            galleryItems.forEach(item => {
              const matches = !category || item.dataset.category === category;
              item.classList.toggle('hidden', !matches);
              if (matches) visible++;
            });
            if (galleryEmpty) {
              galleryEmpty.classList.toggle('show', visible === 0);
            }
          }

          tabs.forEach(tab => {
            tab.addEventListener('click', () => {
              const category = tab.dataset.category || '';
              tabs.forEach(btn => {
                const isActive = btn === tab;
                btn.classList.toggle('active', isActive);
                btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
              });
              applyGalleryFilter(category);
            }, { passive: true });
          });

          const initialTab = tabs.find(btn => btn.classList.contains('active')) || tabs[0];
          if (initialTab) {
            applyGalleryFilter(initialTab.dataset.category || '');
          } else if (!galleryItems.length && galleryEmpty) {
            galleryEmpty.classList.add('show');
          }
        }

        // Hide query parameters after load
        if (window.history.replaceState) {
          const cleanUrl = window.location.origin + window.location.pathname;
          window.history.replaceState({}, document.title, cleanUrl);
        }
 

    </script>




</body>
</html>
